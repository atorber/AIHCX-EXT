# 开发指南

<cite>
**本文档引用的文件**
- [package.json](file://package.json)
- [tsconfig.json](file://tsconfig.json)
- [vite.config.ts](file://vite.config.ts)
- [simple-debug.js](file://scripts/simple-debug.js)
- [popup/main.tsx](file://src/popup/main.tsx)
- [options/main.tsx](file://src/options/main.tsx)
- [background/index.ts](file://src/background/index.ts)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [本地开发环境搭建](#本地开发环境搭建)
4. [TypeScript编译配置](#typescript编译配置)
5. [Vite构建工具配置](#vite构建工具配置)
6. [可用npm脚本](#可用npm脚本)
7. [调试技巧](#调试技巧)
8. [结论](#结论)

## 简介
本文档旨在为贡献者提供详细的开发指南，涵盖本地开发环境的搭建、TypeScript和Vite的配置细节、可用的npm脚本以及调试技巧。通过遵循本指南，开发者可以快速上手并高效地进行开发工作。

## 项目结构
本项目采用模块化设计，主要分为以下几个部分：
- `src`：源代码目录，包含所有前端组件、服务和工具。
- `scripts`：构建和发布相关的脚本文件。
- `styles`：全局样式文件。
- `components`：可复用的UI组件。
- `handlers`：页面处理逻辑。
- `services`：API服务调用。
- `utils`：通用工具函数。

**Section sources**
- [package.json](file://package.json)

## 本地开发环境搭建
要开始开发，请确保已安装Node.js（建议版本16以上）和npm。然后按照以下步骤操作：

1. 克隆仓库到本地。
2. 进入项目根目录，运行 `npm install` 安装依赖。
3. 使用 `npm run dev` 启动开发服务器。

开发服务器将自动监听文件变化并实时更新。

**Section sources**
- [package.json](file://package.json)

## TypeScript编译配置
`tsconfig.json` 文件定义了TypeScript编译器的行为。以下是关键选项及其意义：

- `"target": "ES2020"`：指定编译后的JavaScript目标版本。
- `"lib": ["ES2020", "DOM", "DOM.Iterable"]`：指定包含的库文件。
- `"module": "ESNext"`：指定模块系统为ES6模块。
- `"strict": true`：启用所有严格的类型检查选项。
- `"jsx": "react-jsx"`：支持React的JSX语法。
- `"types": ["chrome", "node"]`：引入Chrome扩展API和Node.js的类型定义。

这些配置确保代码在现代浏览器中正确运行，并提供良好的类型安全。

**Section sources**
- [tsconfig.json](file://tsconfig.json)

## Vite构建工具配置
`vite.config.ts` 文件配置了Vite构建工具的行为。主要配置包括：

- **入口文件**：通过 `build.rollupOptions.input` 指定多个入口点，如popup、options、background和content。
- **插件使用**：使用 `@vitejs/plugin-react` 支持React，同时自定义插件修复HTML路径和复制资源文件。
- **输出设置**：配置输出目录为 `dist`，并禁用CSS代码分割以简化部署。

此外，还配置了别名 `@` 指向 `src` 目录，方便模块导入。

```mermaid
graph TB
A[vite.config.ts] --> B[入口文件配置]
A --> C[插件配置]
A --> D[输出设置]
B --> E[popup/index.html]
B --> F[options/index.html]
B --> G[background/index.ts]
B --> H[content/index.ts]
C --> I[@vitejs/plugin-react]
C --> J[自定义插件]
D --> K[输出目录: dist]
D --> L[禁用CSS代码分割]
```

**Diagram sources**
- [vite.config.ts](file://vite.config.ts)

**Section sources**
- [vite.config.ts](file://vite.config.ts)

## 可用npm脚本
项目提供了多个npm脚本，用于不同的开发和发布流程：

- `dev`：启动开发服务器，监听文件变化。
- `build`：生产环境构建，包括TypeScript编译和Vite打包。
- `preview`：预览生产构建结果。
- `generate-icons`：生成扩展图标。
- `type-check`：仅执行类型检查，不生成文件。
- `package`：打包扩展程序。
- `test-release`：测试发布流程。
- `release`：执行完整的发布流程。

这些脚本简化了开发和发布过程，确保一致性。

**Section sources**
- [package.json](file://package.json)

## 调试技巧
### 使用simple-debug.js进行问题排查
`scripts/simple-debug.js` 是一个简化调试脚本，可以直接复制到浏览器控制台执行。它提供了以下功能：
- `checkPage()`：检查当前页面状态，验证表单字段是否存在。
- `testDataset()` 和 `testModel()`：测试数据集和模型的表单填充。
- `quickTestDataset()` 和 `quickTestModel()`：快捷测试函数，快速验证填充逻辑。

这些函数帮助开发者快速定位和解决表单填充问题。

### 利用Chrome开发者工具监控扩展
Chrome开发者工具是调试扩展的强大工具。可以通过以下方式使用：
1. 打开Chrome扩展管理页面，启用开发者模式。
2. 找到AIHC助手扩展，点击“背景页”链接打开背景脚本的开发者工具。
3. 在“内容脚本”标签下查看注入页面的脚本。
4. 使用“网络”面板监控API请求，使用“存储”面板检查本地存储数据。

结合 `console.log` 输出，可以全面了解扩展各部分的运行状态。

**Section sources**
- [simple-debug.js](file://scripts/simple-debug.js)
- [background/index.ts](file://src/background/index.ts)

## 结论
通过本指南，贡献者可以快速搭建开发环境，理解项目的TypeScript和Vite配置，掌握可用的npm脚本，并运用有效的调试技巧。这将大大提高开发效率，确保代码质量和稳定性。